# Architecture du Chatbot Psychologue RAG

Ce fichier d√©taille l'architecture compl√®te du chatbot psychologue avec RAG (Retrieval-Augmented Generation).

## üìÅ Structure g√©n√©rale

```
chatbot-RAG/
‚îú‚îÄ‚îÄ psychologue_chatbot.py       # Application Streamlit principale
‚îú‚îÄ‚îÄ ollama_utils_simple.py       # Utilitaires Ollama simplifi√©s
‚îú‚îÄ‚îÄ psychologie_data/
‚îÇ   ‚îî‚îÄ‚îÄ connaissances_base.md    # Base de connaissances psychologiques
‚îú‚îÄ‚îÄ start_psychologue.bat        # Script de d√©marrage Windows
‚îú‚îÄ‚îÄ requirements.txt             # D√©pendances Python
‚îú‚îÄ‚îÄ README.md                    # Documentation compl√®te
‚îî‚îÄ‚îÄ .gitignore                   # Fichiers √† ignorer par Git
```

## üîß D√©tail des composants

### 1. psychologue_chatbot.py - Application principale

#### Classe PsychologueChatbot
```python
class PsychologueChatbot:
    def __init__(self, data_dir: str = "psychologie_data"):
        # Initialisation du chatbot
        # - data_dir: r√©pertoire contenant les documents de connaissances
        # - knowledge_base: dictionnaire {titre: contenu} des documents charg√©s
```

##### M√©thodes principales :

###### load_knowledge_base()
- **R√¥le** : Charge tous les documents Markdown du r√©pertoire psychologie_data/
- **Retour** : Dictionnaire avec les titres et contenus des documents
- **Gestion d'erreurs** : Ignore les fichiers illisibles avec avertissement

###### search_knowledge(query: str, max_results: int = 3)
- **R√¥le** : Recherche dans la base de connaissances avec scoring
- **Algorithme** :
  1. Tokenization simple de la requ√™te (mots-cl√©s)
  2. Recherche dans les titres (score x2) et contenus
  3. Tri par score d√©croissant
  4. Limitation du nombre de r√©sultats
- **Retour** : Liste de tuples (titre, extrait, score)

###### extract_relevant_excerpt(content, query_words, context_chars=200)
- **R√¥le** : Extrait un passage pertinent autour des mots-cl√©s trouv√©s
- **Logique** : Trouve la premi√®re occurrence et extrait un contexte de 200 caract√®res

###### generate_response(user_message, model_name, conversation_history)
- **R√¥le** : G√©n√®re une r√©ponse en combinant RAG + LLM
- **√âtapes** :
  1. Recherche dans la base de connaissances
  2. Construction du contexte avec les documents pertinents
  3. Cr√©ation du prompt syst√®me pour le psychologue
  4. Appel √† Ollama via get_chat_response()
  5. Ajout √† l'historique de conversation
- **Retour** : R√©ponse g√©n√©r√©e par l'IA

#### Fonction main() - Interface Streamlit

##### Initialisation
- Configuration de la page Streamlit
- Initialisation du chatbot et de l'historique
- Variables de session pour la persistance

##### Interface utilisateur

###### Banni√®re d'avertissement
- Message d'erreur rouge en haut de page
- Rappel que c'est un exemple technique uniquement
- Limitations claires (pas de diagnostic, pas de traitement)

###### Sidebar de configuration
- S√©lection du mod√®le Ollama
- Affichage du nombre de documents charg√©s
- Bouton de rechargement de la base
- Bouton d'effacement de l'historique

###### Zone de chat principale
- Affichage de l'historique des messages
- Input utilisateur avec st.chat_input()
- G√©n√©ration et affichage des r√©ponses
- Scroll automatique vers le bas

###### Footer avec ressources d'aide
- Rappel des limitations critiques
- Liste des services d'urgence (SAMU, SOS Amiti√©, etc.)
- Mention que c'est un exemple √©ducatif

### 2. ollama_utils_simple.py - Utilitaires Ollama

#### get_available_models()
- **R√¥le** : R√©cup√®re la liste des mod√®les Ollama install√©s
- **Gestion des formats** : Supporte diff√©rents formats de r√©ponse d'Ollama
- **Fallback** : Retourne "llama2-uncensored:latest" par d√©faut
- **Gestion d'erreurs** : Capture les exceptions de connexion

#### get_chat_response(model_name, user_message, system_prompt, user_prompt, options)
- **R√¥le** : Interface unifi√©e pour les appels √† Ollama
- **Construction des messages** :
  - Message syst√®me (si fourni)
  - Message utilisateur (combinaison user_prompt + user_message)
- **Options** : Param√®tres du mod√®le (temperature, top_p, etc.)
- **Retour** : R√©ponse du mod√®le sous forme de string
- **Gestion d'erreurs** : Message d'erreur si Ollama indisponible

### 3. psychologie_data/connaissances_base.md - Base de connaissances

#### Structure du contenu
- **Format** : Markdown avec titres hi√©rarchiques
- **Organisation** :
  - Concepts fondamentaux (anxi√©t√©, d√©pression, stress)
  - Techniques th√©rapeutiques (TCC, relaxation, m√©ditation)
  - Gestion des √©motions (intelligence √©motionnelle)
  - Sant√© mentale (burnout, r√©seaux sociaux)
  - Psychologie positive (flow, gratitude, r√©silience)

#### Format des entr√©es
- **Titres** : ## Titre du concept
- **Contenu** : Description d√©taill√©e avec sympt√¥mes, causes, conseils
- **Listes** : Utilisation de puces pour les sympt√¥mes et conseils

### 4. start_psychologue.bat - Script de d√©marrage

#### Fonctionnalit√©s
- **V√©rification environnement** : Cr√©e .venv si inexistant
- **Activation** : Active l'environnement virtuel
- **Installation** : pip install -r requirements.txt
- **Lancement** : streamlit run psychologue_chatbot.py --server.port 8501
- **Mode headless** : --server.headless true pour √©viter les popups

### 5. requirements.txt - D√©pendances

#### D√©pendances minimales
```
streamlit      # Framework web pour l'interface
ollama         # Client Python pour Ollama
toml           # Parsing des fichiers de configuration (optionnel)
```

## üîÑ Flux de fonctionnement

### 1. Initialisation
1. Chargement des documents Markdown
2. Indexation du contenu (titre ‚Üí contenu)
3. Configuration de l'interface Streamlit

### 2. Traitement d'une requ√™te utilisateur
1. **Recherche RAG** :
   - Tokenization de la requ√™te
   - Recherche dans titres et contenus
   - Scoring et tri des r√©sultats
   - Extraction d'extraits pertinents

2. **Construction du contexte** :
   - Formatage des documents trouv√©s
   - Cr√©ation du prompt syst√®me psychologue
   - Ajout de l'historique de conversation

3. **G√©n√©ration de r√©ponse** :
   - Appel √† Ollama avec contexte enrichi
   - Post-traitement de la r√©ponse
   - Mise √† jour de l'historique

4. **Affichage** :
   - R√©ponse dans l'interface chat
   - Scroll automatique
   - Persistance en session

## üõ°Ô∏è S√©curit√© et √©thique

### Limitations techniques
- **Recherche simple** : Bas√©e sur mots-cl√©s, pas de s√©mantique avanc√©e
- **Pas de vectorisation** : Pas d'embeddings, juste recherche textuelle
- **Contexte limit√©** : Fen√™tre de 200 caract√®res autour des mots-cl√©s
- **Pas de m√©moire long terme** : Historique limit√© √† la session

### Avertissements int√©gr√©s
- **Banni√®re d'avertissement** : Rappel des limitations d√®s l'ouverture
- **Footer √©ducatif** : Ressources d'aide et rappel √©thique
- **README d√©taill√©** : Documentation compl√®te des limitations

## üöÄ √âvolutions possibles

### Am√©liorations techniques
- **Vectorisation** : Int√©gration d'embeddings (sentence-transformers)
- **Base de donn√©es** : Stockage persistant (SQLite, PostgreSQL)
- **Recherche avanc√©e** : Filtrage par cat√©gories, dates
- **Multi-mod√®les** : Support de plusieurs LLM simultan√©ment

### Fonctionnalit√©s utilisateur
- **Export de conversations** : Sauvegarde en Markdown/PDF
- **Personnalisation** : Th√®mes, langues, pr√©f√©rences
- **Statistiques** : Analyse des interactions fr√©quentes
- **Mode hors ligne** : Cache des r√©ponses communes

### Extension du domaine
- **Multi-domaines** : Architecture modulaire pour diff√©rents sujets
- **Base collaborative** : Contribution communautaire aux connaissances
- **Validation experte** : R√©vision par professionnels du domaine

## üìä M√©triques et monitoring

### M√©triques actuelles
- **Nombre de documents** : Comptage simple
- **Temps de r√©ponse** : Mesure du temps de g√©n√©ration
- **Taux d'erreur** : Exceptions captur√©es
- **Utilisation des mod√®les** : Logs des appels Ollama

### Monitoring possible
- **Logs d√©taill√©s** : Tra√ßabilit√© des recherches et r√©ponses
- **Analytics utilisateur** : Fr√©quence d'utilisation (anonyme)
- **Performance** : Temps de recherche, taux de r√©ussite
- **Feedback** : Syst√®me de notation des r√©ponses

---

*Ce fichier .tree d√©taille l'architecture compl√®te du syst√®me RAG simple impl√©ment√© dans ce projet √©ducatif.*